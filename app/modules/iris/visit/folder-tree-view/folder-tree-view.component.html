<div class="card wrapper-list-document attached">
    <div class="card-header bg-gray-2">
        Attached Redacted Reports
    </div>

    <ul class="list-group list-group-flush bg-gray-1" *ngIf="rootFiles?.length > 0 || attachedReports?.length > 0; else empty">

        <!-- ROOT FILES -->
        <li class="list-group-item bg-gray-1 d-flex align-items-center"
            *ngFor="let report of rootFiles; let i = index">
            <img [src]="getFileIcon(report.reportFilePath)" width="18" height="18" class="me-2" />
            <a [href]="download(report)" download class="report-file">
                {{ report.reportFilePath }}
            </a>
        </li>

        <!-- FOLDERS -->
        <li class="list-group-item bg-gray-1 folder-item"
            [class.expanded]="isFolderExpanded(j)"
            *ngFor="let attachedReport of attachedReports; let j = index">
            <!-- Folder Header -->
            <div class="folder-header" (click)="toggleFolder(j)">
                <div class="folder-title-wrapper">
                    <img src="assets/images/icon/folder.svg" width="20" height="20" class="me-2" />
                    <strong>{{ attachedReport.reportPath }}</strong>
                </div>
                <div class="folder-toggle-icon">
                    <svg *ngIf="!isFolderExpanded(j)" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 12l-4-4h8l-4 4z"/>
                    </svg>
                    <svg *ngIf="isFolderExpanded(j)" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 4l4 4H4l4-4z"/>
                    </svg>
                </div>
            </div>
            
            <!-- Folder Content -->
            <div class="folder-content" [class.expanded]="isFolderExpanded(j)">
                <div class="folder-content-inner">
                    <!-- Files with tree structure -->
                    <ul class="file-tree-list">
                        <li *ngFor="let file of attachedReport.files; let k = index; let isLast = last"
                            [class.last-item]="isLast"
                            class="file-tree-item">
                            <span class="tree-line"></span>
                            <img [src]="getFileIcon(file.reportFilePath)" width="18" height="18" class="file-icon" />
                            <a [href]="download(file)" download class="report-file">
                                {{ file.reportFilePath }}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </li>
    </ul>

    <ng-template #empty>
        <div class="card-body text-muted small bg-gray-1">
            No items in the list.
        </div>
    </ng-template>
</div>
